### 一、测试环境

1. Intel(R) Xeon(R) CPU E5645  @ 2.40GHz 12核 12GB内存
2. 数据采集指标为（命中率，使用内存，avg_time）
3. 流量来自于tcpcopy环境，friendship，业务开关全开
4. 流量情况，READ:19500/S,WRITE:500/S
5. LS4LRU的第二阶段超时时间为第一阶段的2倍
6. S4LRU0和LS4LRU0的内存每层相等，S4LRU1和LS4LRU1内存上层是下层的1/2

### 二、测试数据

1. 最大内存50MB

TIMEOUT|1S|2S|5S|10S|30S|1Min|5Min|不过期
---|---|---|---|---|---|---|---|---
LRU|17% 12M 6.53ms|20% 23M 6.84ms|26% 44M 8.00ms|29% 50M 6.79ms|31% 50M 6.42ms|31% 50M 6.70ms|32% 50M 6.82ms|32% 50M 6.31ms
S4LRU1|17% 13M 6.54ms|21% 20M 6.53ms|26% 32M 6.95ms|30% 36M 6.25ms|33% 45M 6.08ms|34% 50M 6.88ms|37% 50M 7.38ms|39% 50M 7.19ms
LS4LRU1|23% 26M 6.28ms|27% 32M 8.42ms|31% 36M 7.74ms|33% 42M 6.59ms|36% 50M 6.03ms|38% 50M 7.09ms|38% 50M 7.02ms|37% 50M 7.54ms

2. 最大内存100MB

超时时间|1S|2S|5S|10S|30S|1Min|5Min|不过期
---|---|---|---|---|---|---|---|---
LRU|16% 7M 5.03ms|20% 14M 5.14ms|27% 30M 4.95ms|31% 55M 5.21ms|36% 100M 5.34ms|39% 100M 5.49ms|39% 100M 5.87ms|38% 100M 6.42ms
S4LRU1|16% 11M 6.07ms|21% 19M 6.28ms|28% 42M 6.33ms|32% 64M 6.08ms|35% 75M 6.71ms|37% 88M 6.78ms|39% 100M 6.69ms|40% 100M 6.22ms
LS4LRU1|21% 27M 6.37ms|26% 51M 6.27ms|31% 64M 6.23ms|34% 71M 6.66ms|37% 91M 7.06ms|38% 100M 7.08ms|40% 100M 6.98ms|40% 100M 6.35ms

3. 最大内存200MB

超时时间|1S|2S|5S|10S|30S|1Min|5Min|不过期
---|---|---|---|---|---|---|---|---
LRU|17% 13M 7.65ms|21% 25M 6.88ms|27% 46M 6.85ms|31% 87M 6.83ms|37% 200M 7.14ms|38% 200M 7.44ms|41% 200M 6.87ms|42% 200M 6.68ms
S4LRU1|20% 12M 6.65ms|23% 17M 6.39ms|29% 39M 7.16ms|34% 74M 5.90ms|39% 132M 6.25ms|40% 144M 5.78ms|43% 200M 5.78ms|42% 200M 5.70ms
LS4LRU1|20% 22M 5.76ms|24% 37M 5.59ms|30% 90M 6.18ms|35% 127M 6.06ms|38% 150M 6.17ms|41% 177M 5.86ms|43% 200M 6.00ms|43% 200M 5.71ms
 
4. 最大内存500MB

超时时间|1S|2S|5S|10S|30S|1Min|5Min|不过期
---|---|---|---|---|---|---|---|---
LRU|16% 12M 6.21ms|20% 19M 5.70ms|26% 41M 5.54ms|31% 79M 6.27ms|37% 206M 6.27ms|41% 392M 8.11ms|45% 500M 7.10ms|45% 500M 6.21ms
S4LRU1|17% 12M 6.50ms|21% 20M 6.22ms|26% 44M 6.25ms|31% 84M 6.93ms|37% 234M 6.58ms|41% 318M 6.86ms|43% 426M 6.29ms|43% 500M 11.26ms
LS4LRU1|20% 25M 6.49ms|24% 45M 6.65ms|30% 97M 6.59ms|33% 210M 6.84ms|40% 324M 6.93|43% 358M 7.50ms|45% 500M 7.28ms|45% 500M 10.43ms

    根据上面的数据来看有如下规律

1. 不开启LRU、LRU、S4LRU、LS4LRU在各种条件下的平均耗时和CPU没有明显差别。
2. LRU会很快到达内存限制，接着随着超时时间增长命中率不在变化。
3. S4LRU在超时时间小的有跟LRU相似的命中率，随着超时时间增长当LRU内存达到限制时，S4LRU的命中率会继续增长。
4. LS4LRU在超时时间小时命中率比LRU和S4LRU有明显的差异大约高5%左右，超时时间长时和S4LRU类似。

### 三、单个热点数据较多的业务

    根据业务方反馈，user-base热点数据较多，所以单独将user-base拿出来做一个测试。
    
1. 最大内存50MB

超时时间|1S|2S|5S|10S|30S|1Min|5Min|不过期
---|---|---|---|---|---|---|---|---
LRU|30% 5M 2.45ms|36% 9M 2.74ms|45% 18M 2.69ms|51% 31M 2.58ms|57% 50M 2.49ms|59% 50M 2.46ms|59% 50M 2.54ms|59% 50M 2.53ms
S4LRU1|28% 5M 2.77ms|35% 9M 2.77ms|44% 19M 2.63ms|50% 33M 2.68ms|56% 42M 2.55ms|59% 50M 2.53ms|62% 50M 2.39ms|63% 50M 2.33ms
LS4LRU1|35% 10M 2.55ms|41% 16M 2.60ms|48% 33M 2.52ms|53% 37M 2.49ms|58% 49M 2.46ms|60% 50M 2.37ms|62% 50M 2.32ms|63% 50M 2.32ms

2. 最大内存100MB

超时时间|1S|2S|5S|10S|30S|1Min|5Min|不过期
---|---|---|---|---|---|---|---|---
LRU|25% 4M 2.90ms|31% 8M 2.90ms|39% 16M 2.83ms|45% 26M 2.88ms|56% 77M 2.92ms|60% 100M 2.66ms|63% 100M 2.68ms|63% 100M 3.09ms
S4LRU1|26% 5M 2.72ms|32% 9M 2.64ms|42% 18M 2.57ms|48% 33M 2.44ms|57% 70M 2.43ms|60% 79M 2.37ms|64% 100M 2.30ms|66% 100M 2.16ms
LS4LRU1|24% 9M 2.78ms|33% 21M 2.67ms|43% 39M 2.67ms|49% 66M 2.74ms|57% 80M 2.53ms|59% 93M 2.48ms|64% 100M 2.37ms|66% 100M 2.33ms

### 四、结论


- 在几个热点数据较多的业务中开启本地缓存会有很好的效果，在量大致相等的情况下，具体的命中率效果可以参照上面的数据。
- 本地缓存会减少发往后端的流量，一定程度上可以提高单个实例的吞吐量。
